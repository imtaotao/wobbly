<template>
  <div styleName='container'>
    <div
      className='center'
      styleName='title-btns'
    >
      <div
        className='center'
        @click='this.toggle.bind(this, false)'
        :styleName='!isShowSourcecode ? "active" : ""'
      >animation</div>
      <div
        className='center'
        @click='this.toggle.bind(this, true)'
        :styleName='isShowSourcecode ? "active" : ""'
      >sourcecode</div>
    </div>
    <div
      styleName='box'
      v-transition='"slide"'
      v-show='!isShowSourcecode'
    >
      <div
        id='Node'
        styleName='node'
      ></div>
    </div>
    <div
      styleName='box'
      v-transition='"slide"'
      v-show='isShowSourcecode'
    >
      è¿˜æ²¡æœ‰å†™ã€‚ã€‚ã€‚ğŸ˜
    </div>
  </div>
</template>

<script>
const wobbly = require('@Wobbly')
const style = require('../common.css')
const { CSSModules, Component } = require('@Grass')

module.exports = CSSModules(style)(
  class WobblyAll extends Component {
    // #temp

    node = null
  
    beforeCreate() {
      this.state = {
        isShowSourcecode: false,
      }
    }

    toggle (show) {
      if (this.state.isShowSourcecode !== show) {
        this.setState({ isShowSourcecode: show })
      }
    }

    created (dom) {
      setTimeout(() => {
        const node = dom.querySelector('#Node')
        if (node) {
          this.node = node
          this.start()
        }
      }, 1000)
    }

    async start () {
      let other = await this.animate('x', 0, [0, 700], 1000)
      other = await this.animate('y', other, [0, 350], 1500)
      other = await this.animate('x', other, [700, 0], 700)
      await this.animate('y', other, [350, 0], 1000)
      this.start()
    }

    animate (direction, other, move, duration) {
      return new Promise(resolve => {
        wobbly({
          move,
          duration,
          end() {
            resolve(move[1])
          },
        }, val => {
          if (direction === 'x') {
            this.node.style.transform = `translate(${val}px, ${other}px)`
          } else {
            this.node.style.transform = `translate(${other}px, ${val}px)`
          }
        })
        .start()
      })
    }
  }
)
</script>